<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:composition template="../index.xhtml">
        <ui:define name="body">
            <h:form id="formProduto" styleClass="form-container">

                <p:growl id="mensagemGrowl" showDetail="true" life="4000" escape="false"/>
                <p:panel header="Cadastro de Produtos" styleClass="form-card">

                    <h3 class="section-title">Informações Gerais</h3>
                    <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank ui-fluid panel-produto" columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4">

                        <p:outputLabel for="categoria" value="Categoria:" styleClass="font-semibold"/>

                        <p:selectOneMenu id="categoria" value="#{produtoControle.produto.categoria}"
                                         converter="#{produtoControle.categoriaConverter}" required="true" requiredMessage="Categoria é obrigatória.">

                            <f:selectItems value="#{categoriaControle.listaCategoriasAtivas}" var="categoria"
                                           itemLabel="#{categoria.categoria}" itemValue="#{categoria}"/>
                        </p:selectOneMenu>

                        <p:outputLabel for="marca" value="Marca:" styleClass="font-semibold"/>
                        <p:selectOneMenu id="marca" value="#{produtoControle.produto.marca}"
                                         converter="#{produtoControle.marcaConverter}" required="true" requiredMessage="Marca é obrigatória.">
                            <f:selectItems value="#{marcaControle.listaMarcasAtivas}" var="marca"
                                           itemLabel="#{marca.marca}" itemValue="#{marca}"/>
                        </p:selectOneMenu>

                        <p:outputLabel for="ncm" value="NCM:" styleClass="font-semibold"/>
                        <p:inputText id="ncm" value="#{produtoControle.produto.ncm}" required="true"
                                     requiredMessage="O NCM é obrigatório." maxlength="10" placeholder="Digite o NCM do produto"/>

                        <p:outputLabel for="valorVenda" value="Valor de Venda:" styleClass="font-semibold"/>
                        <p:inputNumber id="valorVenda" value="#{produtoControle.produto.valorUnitarioVenda}"
                                       symbol="R$ " decimalSeparator="," thousandSeparator="."
                                       required="true" requiredMessage="O preço de venda é obrigatório."
                                       minValue="0.01" decimalPlaces="2" placeholder="0,00"/>
                    </p:panelGrid>

                    <h3 class="section-title">Derivações do Produto</h3>
                    <p:panelGrid id="panelNovaDev" columns="4" layout="grid" styleClass="ui-panelgrid-blank ui-fluid panel-produto"
                                 columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4">

                        <p:outputLabel for="descricaoDerivacao" value="Descrição: " styleClass="font-semibold"/>
                        <p:inputText id="descricaoDerivacao" value="#{produtoControle.prodDev.descricao}" placeholder="Ex: Manga Curta, Manga Longa"/>

                        <p:outputLabel for="tamanhoDerivacao" value="Tamanho:" styleClass="font-semibold"/>
                        <p:inputText id="tamanhoDerivacao" value="#{produtoControle.prodDev.tamanho}" placeholder="Ex: P, M, G, 38"/>

                        <p:outputLabel for="corDerivacao" value="Cor:" styleClass="font-semibold"/>
                        <p:inputText id="corDerivacao" value="#{produtoControle.prodDev.cor}" placeholder="Ex: Azul, Vermelho"/>

                        <p:outputLabel for="quantidadeDerivacao" value="Quantidade em Estoque:" styleClass="font-semibold"/>
                        <p:inputNumber id="quantidadeDerivacao" value="#{produtoControle.prodDev.quantidade}"
                                       minValue="0" decimalPlaces="0" placeholder="0"/>
                    </p:panelGrid>

                    <p:commandButton value="Adicionar Derivação" icon="pi pi-plus"
                                     actionListener="#{produtoControle.adicionarDerivacao()}"
                                     process="@this descricaoDerivacao tamanhoDerivacao corDerivacao quantidadeDerivacao"
                                     update="tabelaDev :formProduto:mensagemGrowl panelNovaDev"
                                     styleClass="ui-button-info mb-3"/>

                    <p:dataTable id="tabelaDev" value="#{produtoControle.produto.variacoes}" var="dev"
                                 emptyMessage="Nenhuma derivação adicionada." rows="3" paginator="true"
                                 paginatorPosition="bottom" styleClass="tabela-derivacoes mb-3"
                                 rowsPerPageTemplate="3,5,10">
                        <p:column headerText="Descrição" sortBy="#{dev.descricao}">
                            <h:outputText value="#{dev.descricao}" />
                        </p:column>
                        <p:column headerText="Tamanho" sortBy="#{dev.tamanho}">
                            <h:outputText value="#{dev.tamanho}" />
                        </p:column>
                        <p:column headerText="Cor" sortBy="#{dev.cor}">
                            <h:outputText value="#{dev.cor}" />
                        </p:column>
                        <p:column headerText="Qtd. Estoque" sortBy="#{dev.quantidade}" style="text-align:center;">
                            <h:outputText value="#{dev.quantidade}" />
                        </p:column>
                        <p:column headerText="Ações" style="width:100px; text-align:center;">
                            <p:commandButton icon="pi pi-trash" title="Remover Derivação"
                                             actionListener="#{produtoControle.removerDerivacao(dev)}"
                                             process= "@this"
                                             update=":formProduto:tabelaDev :formProduto:mensagemGrowl :formProduto:panelNovaDev"
                                             styleClass="ui-button-danger rounded-button"/>
                        </p:column>
                    </p:dataTable>

                    <div class="button-group mt-3">
                        <p:commandButton value="Salvar Produto" icon="pi pi-save"
                                         action="#{produtoControle.salvar()}"
                                         update="@form :formProduto:mensagemGrowl" styleClass="ui-button-success" style="margin-right: 10px"/>
                        <p:commandButton value="Cancelar" icon="pi pi-times"
                                         action="listaProduto.xhtml?faces-redirect=true" immediate="true"
                                         styleClass="ui-button-secondary"/>
                    </div>

                    <p:divider layout="horizontal" styleClass="mt-3 mb-3"/>

                    <div class="button-group-secondary">
                        <p:commandButton value="Nova Categoria" icon="pi pi-tags"
                                         action="categoriaCadastro.xhtml?faces-redirect=true" immediate="true"
                                         styleClass="ui-button-help ui-button-outlined" style="margin-right: 10px"/>
                        <p:commandButton value="Nova Marca" icon="pi pi-bookmark"
                                         action="marcaCadastro.xhtml?faces-redirect=true" immediate="true"
                                         styleClass="ui-button-help ui-button-outlined"/>
                    </div>
                </p:panel>
            </h:form>
            <style>
                body {
                    background-color: #f0f4f8;
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                }
                .form-container {
                    width: 100%;
                    max-width: 1300px;
                    margin-left: 40px;
                    margin-right: auto;
                    padding: 10px;
                }

                .form-card {
                    padding: 25px;
                    border-radius: 10px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    background-color: #ffffff;
                }

                /* Título do p:panel */
                .ui-panel-titlebar {
                    background-color: #007bff !important;
                    color: #fff !important;
                    font-weight: bold;
                    font-size: 18px;
                    padding: 12px 20px !important;
                    border-top-left-radius: 10px;
                    border-top-right-radius: 10px;
                    border: none !important;
                    box-shadow: none !important;
                }

                .font-semibold {
                    font-weight: 600;
                    color: #2c3e50;
                }

                .section-title {
                    margin-top: 30px;
                    margin-bottom: 10px;
                    font-size: 18px;
                    font-weight: bold;
                    color: #007bff;
                    border-bottom: 2px solid #007bff;
                    padding-bottom: 5px;
                }
                .ui-inputfield,
                .ui-selectonemenu-label,
                .ui-inputnumber .ui-inputfield {
                    border-radius: 6px !important;
                    padding: 8px 10px !important;
                }

                .ui-inputfield:focus,
                .ui-selectonemenu:focus,
                .ui-inputnumber .ui-inputfield:focus {
                    border-color: #007bff !important;
                    box-shadow: 0 0 0 0.15rem rgba(0, 123, 255, 0.25) !important;
                }

                .ui-button,
                .ui-button-info,
                .ui-button-success,
                .ui-button-secondary {
                    border-radius: 6px;
                    font-weight: 600;
                }

                .ui-button-success {
                    background-color: #007bff;
                    border-color: #007bff;
                }

                .ui-button-success:hover {
                    background-color: #0056b3;
                    border-color: #004b9b;
                }

                .ui-button-secondary {
                    background-color: #6c757d;
                    border-color: #6c757d;
                }

                .ui-button-secondary:hover {
                    background-color: #5a6268;
                    border-color: #4e555b;
                }

                .ui-panelgrid .ui-panelgrid-cell {
                    padding: 0.5rem;
                }
            </style>
        </ui:define>
    </ui:composition>
</html>
