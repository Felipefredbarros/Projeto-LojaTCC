<ui:composition template="/index.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:define name="body">
        <div class="form-wrapper vertical-layout">
            <div class="form-container card-unificado">

                <h:form id="formListaMovimentacoes">
                    <h1 class="form-title-alt">Movimentações de Vendas dos Funcionarios</h1>
                    <p:dataTable id="tabelaMov" widgetVar="tabelaMovWV"
                                 scrollable="true" scrollHeight="250px"
                                 value="#{movimentacaoMensalControle.movimentacoesFuncionario}" var="m"
                                 emptyMessage="Nenhuma movimentação cadastrada." rows="6" paginator="false"
                                 styleClass="tabela-categorias" rowsPerPageTemplate="6,12,18">

                        <p:column headerText="Funcionário"  filterBy="#{m.funcionario.nome}" filterMatchMode="contains"  style="text-align: center">
                            <h:outputText value="#{m.funcionario.nome}" />
                        </p:column>
                        <p:column headerText="Data: (DD/MM/AAAA):"  style="text-align: center">
                            <h:outputText value="#{m.data}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Tipo de Bonus" filterBy="#{m.tipoBonus.descricao}" filterMatchMode="exact"  style="text-align: center">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('tabelaMovWV').filter()" styleClass="custom-filter">
                                    <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItems value="#{movimentacaoMensalControle.tiposBonusDisponiveis}" var="tipoFiltro"
                                                   itemLabel="#{tipoFiltro.descricao}" itemValue="#{tipoFiltro.descricao}"/>
                                </p:selectOneMenu>
                            </f:facet>
                            <h:outputText value="#{m.tipoBonus.descricao}" />
                        </p:column>
                        <p:column headerText=" Bonus: "  style="text-align: center">
                            <h:outputText value="#{m.bonus}">
                                <f:convertNumber type="currency"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Ações" style="width:120px; text-align:center;">
                            <p:commandButton icon="pi pi-search" title="Visualizar"
                                             actionListener="#{movimentacaoMensalControle.prepararVisualizacao(m)}"
                                             process="@this"
                                             update=":formListaMovimentacoes:movimentacaoDetailPanel"
                                             oncomplete="PF('movimentacaoDialog').show()"
                                             styleClass="rounded-button ui-button-info"
                                             style="margin-right: 5px;"
                                             rendered="#{m.tipoBonus eq 'COMISSAO'}"/>
                        </p:column>
                    </p:dataTable>
                    <p:dialog id="dialogT" header="Detalhes da Movimentação" widgetVar="movimentacaoDialog" modal="true" 
                              resizable="false" width="800" height="800" closeOnEscape="true"
                              dynamic="true" responsive="true" styleClass="meu-dialogo">

                        <p:outputPanel id="movimentacaoDetailPanel">

                            <div class="info-box-grid" rendered="#{not empty movimentacaoMensalControle.movSelecionado}">
                                <h3 class="section-title"><strong>Informações da Movimentação</strong></h3>

                                <div class="info-box">
                                    <span class="label"><strong>Data</strong></span>
                                    <span class="value">
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.data}">
                                            <f:convertDateTime pattern="dd/MM/YYYY"/>
                                        </h:outputText>
                                    </span>

                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>Tipo de Bonus</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.tipoBonus.descricao}</span>
                                </div>

                                <div class="info-box">
                                    <span class="label"><strong>Valor do Bonus:</strong></span>
                                    <span class="value">
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.bonus}">
                                            <f:convertNumber type="currency"/>
                                        </h:outputText>
                                    </span>
                                </div>

                                <h3 class="section-title"><strong>Informações do Funcionario</strong></h3>

                                <div class="info-box">
                                    <span class="label"><strong>Nome</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.funcionario.nome}</span>
                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>E-MAIL</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.funcionario.email}</span>
                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>CPF/CNPJ</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.funcionario.cpfcnpjFormatado}</span>
                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>Dia de Inicio de Contrato:</strong></span>
                                    <span class="value">                                        
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.funcionario.contrato.dataInicio}">
                                            <f:convertDateTime pattern="dd/MM/YYYY"/>
                                        </h:outputText>
                                    </span>
                                </div>

                                <div class="info-box">
                                    <span class="label"><strong>Jornada de Trabalho diaria(Horas):</strong></span>
                                    <span class="value">
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.funcionario.contrato.jornadaDiariaHoras}">
                                            <f:convertNumber integerOnly="true" groupingUsed="true" />
                                        </h:outputText>
                                    </span>
                                </div>

                                <div class="info-box">
                                    <span class="label"><strong>Salário:</strong></span>
                                    <span class="value">
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.funcionario.contrato.salario}">
                                            <f:convertNumber type="currency"/>
                                        </h:outputText>
                                    </span>
                                </div>

                                <div class="info-box">
                                    <span class="label"><strong>Cargo:</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.funcionario.contrato.cargo}</span>
                                </div>


                                <div class="info-box">
                                    <span class="label"><strong>Dia do Pagamento:</strong></span>
                                    <span class="value">
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.funcionario.contrato.diaPagamentos}">
                                            <f:convertDateTime pattern="dd/MM"/>
                                        </h:outputText>
                                    </span>
                                </div>
                                <h3 class="section-title"><strong>Informações da Venda</strong></h3>
                                <div class="info-box">
                                    <span class="label"><strong>Valor Total:</strong></span>
                                    <span class="value">
                                        <h:outputText value="#{movimentacaoMensalControle.movSelecionado.venda.valorTotal}">
                                            <f:convertNumber type="currency"/>
                                        </h:outputText>
                                    </span>
                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>Cliente:</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.venda.cliente.nome}</span>
                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>Plano de Pagamento:</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.venda.planoPagamento.descricao}</span>
                                </div>
                                <div class="info-box">
                                    <span class="label"><strong>Método de Pagamento:</strong></span>
                                    <span class="value">#{movimentacaoMensalControle.movSelecionado.venda.metodoPagamento.descricao}</span>
                                </div>
                            </div>
                            <!-- Itens -->
                            <h3 class="section-title"><strong>Itens</strong></h3>
                            <p:dataTable value="#{movimentacaoMensalControle.movSelecionado.venda.itensVenda}" var="item" scrollable="true" scrollHeight="300"
                                         styleClass="tabela-dialogo" style="width:100%; margin-bottom: 30px;">    
                                <p:column headerText="Descrição"><h:outputText value="#{item.produtoDerivacao.descricao}"/></p:column>
                                <p:column headerText="Tamanho"><h:outputText value="#{item.produtoDerivacao.tamanho}"/></p:column>
                                <p:column headerText="Cor"><h:outputText value="#{item.produtoDerivacao.cor}"/></p:column>
                                <p:column headerText="Quantidade"><h:outputText value="#{item.quantidade}">
                                        <f:convertNumber integerOnly="true" groupingUsed="true" />
                                    </h:outputText></p:column>
                                <p:column headerText="valorUnitario"><h:outputText value="#{item.valorUnitario}"/></p:column>
                                <p:column headerText="subTotal"><h:outputText value="#{item.subTotal}"/></p:column>
                            </p:dataTable>


                        </p:outputPanel>

                        <p:commandButton value="Fechar" onclick="PF('pessoaDialog').hide()" styleClass="btn-edit"
                                         style="margin-top:30px; float:right"/>
                    </p:dialog>
                </h:form>

            </div>
        </div>

        <!-- Confirmação global -->
        <h:form id="formConfirmDialog">
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times"/>
            </p:confirmDialog>
        </h:form>

        <!-- CSS Adaptado -->
        <style type="text/css">
            .form-wrapper.vertical-layout {
                display: block;
                padding: 8px;
                background-color: #f8f9fa;
            }
            .card-unificado {
                background: #fff;
                width: 100%;
                padding: 25px 40px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                margin: auto;
                max-width: 1300px;
                margin-left: 40px;
                margin-right: auto;
            }
            .form-title {
                text-align: center;
                color: #007bff;
                margin-bottom: 30px;
                font-size: 1.75rem;
                font-weight: 600;
            }
            .form-title-alt {
                text-align: center;
                color: #495057;
                margin-top: 30px;
                margin-bottom: 20px;
                font-size: 1.5rem;
                font-weight: 500;
            }
            .font-semibold {
                font-weight: 600 !important;
            }
            .mb-3 {
                margin-bottom: 1.5rem !important;
            }
            .mr-2 {
                margin-right: 0.5rem;
            }
            .ui-inputtext, .ui-inputnumber, .ui-calendar {
                padding: 0.4rem 0.5rem !important;
                font-size: 0.9rem !important;
                border-color: #ced4da !important;
                width: 200px !important;
                max-width: 80% !important;
            }
            .ui-inputtext:focus, .ui-inputnumber:focus, .ui-calendar:focus {
                border-color: #007bff;
                box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
            }
            /* Ajuste do botão Salvar */
            .ui-button-success {
                background-color: #28a745;
                color: #fff;
                padding: 0.4rem 0.8rem !important;
                font-size: 0.9rem !important;
            }
            .ui-button-info    {
                background-color: #17a2b8;
                color: #fff;
            }
            .ui-button-danger  {
                background-color: #dc3545;
                color: #fff;
            }
            .rounded-button {
                border-radius: 0.375rem;
            }
            .tabela-categorias .ui-datatable-scrollable-body {
                max-height: 250px !important;
            }
        </style>
    </ui:define>
</ui:composition>
